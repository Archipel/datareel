Linux kernel tuning for load balancing
Last modified: 07/15/2016

Below are some kernel tuning parameters for Linux servers hosting load
balancer services. NOTE: This setting are dependant on the type of
network service you are load balancing. All setting listed below must
be application tested and set based on the number of connections to
your frontend LB and backend hosts.


File Handle Limits:
------------------
# sysctl fs.file-max | tee -a /root/sysctl_org_settings.txt

# vi /etc/sysctl.conf

fs.file-max = 25000000

# sysctl -p

NOTE: Use above methods for saving original kernel setting and making
setting persistent. 

IPv4 Socket Tuning:
------------------
For a large numbers of concurent sessions:

net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 60
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.tcp_syncookies = 1
net.core.somaxconn = 1024

IPv4 Settings:

net.ipv4.ip_forward = 1
net.ipv4.ipfrag_max_dist = 4096
net.ipv4.ip_nonlocal_bind=1

Process Scheduler:
-----------------

kernel.sched_migration_cost = 5000000
kernel.sched_autogroup_enabled = 0

Threads:
-------

kernel.threads-max = 5000000
vm.max_map_count = 128000
kernel.pid_max = 65536
                
